-- Universal RGB Player ESP with Dragable Menu (Dialog Always Centered, Drag Button Only)
-- By Copilot | 2025

if game.CoreGui:FindFirstChild("UniversalESPMenu") then
    game.CoreGui.UniversalESPMenu:Destroy()
end

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

-- UI Creation
local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = "UniversalESPMenu"
gui.ResetOnSpawn = false

-- Drag Menu Button
local menuBtn = Instance.new("TextButton", gui)
menuBtn.Size = UDim2.new(0, 120, 0, 40)
menuBtn.Position = UDim2.new(0, 100, 0, 100)
menuBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
menuBtn.TextColor3 = Color3.fromRGB(255,255,255)
menuBtn.Text = "ESP MENU"
menuBtn.Name = "DragMenuBtn"
menuBtn.Font = Enum.Font.GothamBold
menuBtn.TextSize = 18
menuBtn.BorderSizePixel = 0
menuBtn.ZIndex = 10

-- Main Dialog (always centered)
local dialog = Instance.new("Frame", gui)
dialog.Size = UDim2.new(0, 240, 0, 160)
dialog.Position = UDim2.new(0.5, -120, 0.5, -80)
dialog.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
dialog.Visible = false
dialog.Active = false
dialog.BorderSizePixel = 0
dialog.ZIndex = 11

local title = Instance.new("TextLabel", dialog)
title.Size = UDim2.new(1, 0, 0, 32)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Universal RGB ESP"
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextSize = 20
title.ZIndex = 12

local statusLabel = Instance.new("TextLabel", dialog)
statusLabel.Size = UDim2.new(1, 0, 0, 24)
statusLabel.Position = UDim2.new(0, 0, 0, 40)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Status: OFF"
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextColor3 = Color3.fromRGB(200,255,200)
statusLabel.TextSize = 16
statusLabel.ZIndex = 12

local toggleBtn = Instance.new("TextButton", dialog)
toggleBtn.Size = UDim2.new(0.7, 0, 0, 36)
toggleBtn.Position = UDim2.new(0.15, 0, 0, 80)
toggleBtn.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Text = "ENABLE ESP"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 18
toggleBtn.BorderSizePixel = 0
toggleBtn.ZIndex = 12

local note = Instance.new("TextLabel", dialog)
note.Size = UDim2.new(1, -10, 0, 28)
note.Position = UDim2.new(0, 5, 1, -32)
note.BackgroundTransparency = 1
note.Text = "Drag menu btn | Click menu btn to close"
note.Font = Enum.Font.Gotham
note.TextColor3 = Color3.fromRGB(200,200,200)
note.TextSize = 13
note.ZIndex = 12

-- Menu Button Dragging (only the button moves!)
local dragging = false
local dragOffset = Vector2.new()
menuBtn.MouseButton1Down:Connect(function(input)
    dragging = true
    dragOffset = Vector2.new(input.Position.X - menuBtn.AbsolutePosition.X, input.Position.Y - menuBtn.AbsolutePosition.Y)
end)
game:GetService("UserInputService").InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)
game:GetService("UserInputService").InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local mousePos = input.Position
        local newX = mousePos.X - dragOffset.X
        local newY = mousePos.Y - dragOffset.Y
        menuBtn.Position = UDim2.new(0, newX, 0, newY)
    end
end)

-- Menu open/close logic (dialog always centered)
local function centerDialog()
    local vp = workspace.CurrentCamera and workspace.CurrentCamera.ViewportSize or Vector2.new(800,600)
    dialog.Position = UDim2.new(0, (vp.X-dialog.AbsoluteSize.X)/2, 0, (vp.Y-dialog.AbsoluteSize.Y)/2)
end
menuBtn.MouseButton1Click:Connect(function()
    dialog.Visible = not dialog.Visible
    if dialog.Visible then
        centerDialog()
    end
end)
-- Also re-center dialog on viewport resize
game:GetService("RunService").RenderStepped:Connect(function()
    if dialog.Visible then centerDialog() end
end)

-- ESP Logic (simple RGB highlight for all players except LocalPlayer)
local ESP_ENABLED = false
local ESP_Highlights = {}
local function getRainbowColor()
    return Color3.fromHSV((tick()*2)%1, 1, 1)
end
local function clearESP()
    for p,v in pairs(ESP_Highlights) do
        if v and v.Parent then v:Destroy() end
    end
    table.clear(ESP_Highlights)
end
local function createESP(player)
    if player == LocalPlayer then return end
    local function tryChar()
        local char = player.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local highlight = Instance.new("Highlight")
            highlight.Name = "RGB_ESP"
            highlight.FillTransparency = 1
            highlight.OutlineTransparency = 0
            highlight.OutlineColor = Color3.new(1,1,1)
            highlight.Parent = char
            ESP_Highlights[player] = highlight
        end
    end
    tryChar()
    player.CharacterAdded:Connect(function()
        task.wait(1)
        tryChar()
    end)
end
local function removeESP(player)
    if ESP_Highlights[player] and ESP_Highlights[player].Parent then
        ESP_Highlights[player]:Destroy()
    end
    ESP_Highlights[player] = nil
end
local function enableESP()
    ESP_ENABLED = true
    for _,player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            createESP(player)
        end
    end
    statusLabel.Text = "Status: ON"
    toggleBtn.Text = "DISABLE ESP"
    toggleBtn.BackgroundColor3 = Color3.fromRGB(180, 40, 40)
end
local function disableESP()
    ESP_ENABLED = false
    clearESP()
    statusLabel.Text = "Status: OFF"
    toggleBtn.Text = "ENABLE ESP"
    toggleBtn.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
end
toggleBtn.MouseButton1Click:Connect(function()
    if ESP_ENABLED then
        disableESP()
    else
        enableESP()
    end
end)
Players.PlayerAdded:Connect(function(player)
    if ESP_ENABLED then
        createESP(player)
    end
end)
Players.PlayerRemoving:Connect(function(player)
    removeESP(player)
end)
RunService.RenderStepped:Connect(function()
    if ESP_ENABLED then
        for player, highlight in pairs(ESP_Highlights) do
            if player and player.Character and highlight and highlight.Parent then
                highlight.OutlineColor = getRainbowColor()
            end
        end
    end
end)

-- Cleanup if GUI destroyed
gui.AncestryChanged:Connect(function(_, parent)
    if not parent then
        clearESP()
    end
end)
